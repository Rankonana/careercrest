{% extends 'base-resume-create.html' %}
{% block title %}finalize{% endblock %}
{% block content %}
{% load static %}

{% block head %}

<!-- <style>
    #software-table {
    border-collapse: collapse;
    width: 100%;
    }

    #software-table th,
    #software-table td {
    text-align: left;
    padding: 8px;
    }

    #software-table th {
    background-color: #4CAF50;
    color: white;
    }

    #software-table tbody tr:nth-child(even) {
    background-color: #f2f2f2;
    }

    #software-table tbody input[type="text"] {
    border: none;
    padding: 6px 10px;
    box-sizing: border-box;
    width: 100%;
    font-size: 14px;
    }

    #software-table tbody input[type="text"]:focus {
    outline: none;
    background-color: #e6f7ff;
    }



</style> -->

{% endblock head %}
    <meta name="csrf-token" content="{{ csrf_token }}">


<div class="container" >
    
    <div id="finalize-div" style="display: block;">
        <div id="finalize" class="question visible">
            <h1>Do you have anything else to add? </h1>
            <p> These sections are optional.</p>
            <div class="row">
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-6">
                            <form class="form-check-inline">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  name="chk-finalize" id="chk-finalize" value="finalize" onchange="funcheckbox();" checked="checked" style="display:none;">
                                    <label class="form-check-label"  for="chk-finalize" style="display:none;">finalize</label>
                                    
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="chk-accomplishments" id="chk-accomplishments" value="accomplishments" onchange="funcheckbox();">
                                    <label class="form-check-label" for="chk-accomplishments">Accomplishments</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="chk-affiliations" id="chk-affiliations" value="affiliations" onchange="funcheckbox();">
                                    <label class="form-check-label"for="chk-affiliations">Affiliations</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="chk-additional-info" id="chk-additional-info" value="additional-info" onchange="funcheckbox();">
                                    <label class="form-check-label"for="chk-additional-info">Additional Information</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="chk-software" id="chk-software" value="software" onchange="funcheckbox();">
                                    <label class="form-check-label"for="chk-software">Software</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="chk-languages" id="chk-languages" value="languages" onchange="funcheckbox();">
                                    <label class="form-check-label"for="chk-languages">Languages</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="chk-certifications" id="chk-certifications" value="certifications" onchange="funcheckbox();">
                                    <label class="form-check-label"for="chk-certifications">Certifications</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="chk-interests" id="chk-interests" value="interests" onchange="funcheckbox();">
                                    <label class="form-check-label"for="chk-interests">Interests</label>
                                </div>
                            
                              </form>
                            

                        </div>
                        <div class="col-md-6">
                           

                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="chk-yourown" name="chk-yourown" value="yourown" onchange="funcheckbox();">
                                <label class="form-check-label" for="chk-yourown">Your Own</label>
                                <input type="text" class="form-control" id="yourowntextbox" name="yourowntextbox" placeholder="e.g. Hobbies">
                              </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 resume-thumbnail ">
                    <div class="col">
                        <img src="http://localhost/images/resume-preview.jpg" alt="Image">
                    </div>
                    <button type="button" class="btn btn-primary">Change Template</button>
                </div>
            </div>
            <a href="{% url 'create-summary' tracking %}" class="btn btn-primary"> Back</a>
            <button class="next-btn btn btn-danger"  >Next</button>
        </div>
        <div id="accomplishments" class="question">
            <h1> Accomplishments </h1>
            <!-- copied from summary  start -->
            <div class="row">
                <div class="col-md-7 summary-suggestions">
                    <label for="summary-suggestions-label" class="control-label">Search by job title for pre-written examples</label>
                    <div class="row">
                        <div class="col-10">
                            <input type="search" name="search-box-accomplishments" id="search-box-accomplishments" class="form-control" placeholder="Title, industry, keyword">
                            <ul id="search-suggestions-accomplishments"></ul>
                        </div>
                        <div class="col-2">
                            <button type="button" id="btn-title-search-accomplishments" class="btn btn-primary" title="search"> Search</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-5">
                            <div id="related-popular-accomplishments"></div>
                        </div>
                        <div class="col-7">
                            <label for="summary-label" class="control-label">Showing results for : <p id="jobtitledisplay-accomplishments" style="font-weight: bold;"></p>
                            </label>
                            <div id="loading-accomplishments" style="display: none;">Loading...</div>
                            <div id="suggestions-accomplishments">
                                <ul id="result-list-accomplishments">
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5 skills">
                    <label for="summary-label" class="control-label">Nice! Now let's add your accomplishments</label>
                    <div id="display-jog-title-employer-city"></div>
                    <div class="form-group">
                        <!-- <textarea id="summary-description-accomplishments" name="summary-description-accomplishments" rows="5" cols="120" style="max-width:100%;" placeholder="Type in your accomplishments here."></textarea> -->
                    
                        <form method="post" >
                            {% csrf_token %}
                                    <div class="row">
                                        <div class="form-group">
                                            {{ acc_form.accomplishments }}
                                        </div>
                                    </div>
                            <button type="submit" name="acc_form_submit" class="btn btn-danger">Save And Next</button>
                        </form>
                    </div>
                </div>
            </div>
            <!-- copied from summary end -->
            <button class="back-btn btn btn-primary">Back</button>
            <button class="next-btn btn btn-danger">Next</button>
        </div>
        <div id="affiliations" class="question">
            <h1> Affiliations </h1>
            <!-- copied from summary  start -->
            <div class="row">
                <div class="col-md-7 summary-suggestions">
                    <label for="summary-suggestions-label" class="control-label">Search by job title for pre-written examples</label>
                    <div class="row">
                        <div class="col-10">
                            <input type="search" name="search-box-affiliations" id="search-box-affiliations" class="form-control" placeholder="Title, industry, keyword">
                            <ul id="search-suggestions-affiliations"></ul>
                        </div>
                        <div class="col-2">
                            <button type="button" id="btn-title-search-affiliations" class="btn btn-primary" title="search"> Search</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-5">
                            <div id="related-popular-affiliations"></div>
                        </div>
                        <div class="col-7">
                            <label for="summary-label" class="control-label">Showing results for : <p id="jobtitledisplay-affiliations" style="font-weight: bold;"></p>
                            </label>
                            <div id="loading-affiliations">Loading...</div>
                            <div id="suggestions-affiliations">
                                <ul id="result-list-affiliations"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5 skills">
                    <label for="summary-label" class="control-label">Nice! Now let's add your skills</label>
                    <div id="display-jog-title-employer-city"></div>
                    <div class="form-group">
                        <!-- <textarea id="summary-description-affiliations" name="summary-description-affiliations" rows="5" cols="120" style="max-width:100%;" placeholder="Type in your skills here."></textarea> -->
                        <form method="post" >
                            {% csrf_token %}
                                    <div class="row">
                                        <div class="form-group">
                                            {{ aff_form.affiliations }}
                                        </div>
                                    </div>
                            <button type="submit" name="aff_form_submit" class="btn btn-danger">Save And Next</button>
                        </form>
                    </div>
                </div>
            </div>
            <button class="back-btn btn btn-primary">Back</button>
            <button class="next-btn btn btn-danger">Next</button>
        </div>
        <div id="additional-info" class="question">
            <h1> Additional Information </h1>
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <!-- <textarea id="additional-info-description" name="additional-info-description" rows="6" cols="120" style="max-width:100%;" placeholder="Write your addtional information here"></textarea> -->
                    
                        <form method="post" >
                            {% csrf_token %}
                                    <div class="row">
                                        <div class="form-group">
                                            {{ adds_form.additionalinformation }}
                                        </div>
                                    </div>
                            <button type="submit" name="adds_form_submit" class="btn btn-danger">Save And Next</button>
                        </form>
                    </div>
                </div>
            </div>
            <button class="back-btn btn btn-primary">Back</button>
            <button class="next-btn btn btn-danger">Next</button>
        </div>
        <div id="software" class="question">
            <h1> Software </h1>
            <div class="row">
                <label for="summary-label" class="control-label">What software skills do you have?</label>
            </div>
            <div class="row">
                <table id="software-table">
                    <thead>
                        <tr>
                            <th>Software Name</th>
                            <th>Proficiency</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="row">
                <!-- <a onclick="theaddmoreSoftwareSkills()" class="btn btn-outline-primary"> + Add Software Skill</a> -->
                <a href="{% url 'addeditSoftware' tracking newone  %}" class="btn btn-outline-primary"> + Add new one</a>

            </div>
            <button class="back-btn btn btn-primary">Back</button>
            <button class="next-btn btn btn-danger">Next</button>
        </div>
        <div id="languages" class="question">
            <h1> Languages </h1>
            <div class="row">
                <label for="summary-label" class="control-label">What languages do you know?</label>
            </div>
            <div class="row">
                <table id="language-table">
                    <thead>
                        <tr>
                            <th>Language</th>
                            <th>Proficiency</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="row">
                <!-- <a onclick="theaddmorelanguages()" class="btn btn-outline-primary"> + Add a language</a> -->
                <a href="{% url 'addeditLanguage' tracking newone  %}" class="btn btn-outline-primary"> + Add new one</a>

            </div>
            <button class="back-btn btn btn-primary">Back</button>
            <button class="next-btn btn btn-danger">Next</button>
        </div>
        <div id="certifications" class="question">
            <h1>Certifications </h1>
            <!-- copied from summary  start -->
            <div class="row">
                <div class="col-md-7 summary-suggestions">
                    <label for="summary-suggestions-label" class="control-label">Search by job title for pre-written examples</label>
                    <div class="row">
                        <div class="col-10">
                            <input type="search" name="search-box-certifications" id="search-box-certifications" class="form-control" placeholder="Title, industry, keyword">
                            <ul id="search-suggestions-certifications"></ul>
                        </div>
                        <div class="col-2">
                            <button type="button" id="btn-title-search-certifications" class="btn btn-primary" title="search"> Search</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-5">
                            <div id="related-popular-certifications"></div>
                        </div>
                        <div class="col-7">
                            <label for="summary-label" class="control-label">Showing results for : <p id="jobtitledisplay-certifications" style="font-weight: bold;"></p>
                            </label>
                            <div id="loading-certifications">Loading...</div>
                            <div id="suggestions-certifications">
                                <ul id="result-list-certifications"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5 certifications">
                    <label for="summary-label" class="control-label">What certifications would you like to highlight?</label>
                    <div id="display-jog-title-employer-city"></div>
                    <ul id="list-certifications-container">
                        {% for certification in certifications %}

                        <div class="containerxx" id="{{certification.certificationtracking}}">

                            <input type="date" id="certification_date" name="certification_date" class="form-control" value="{{ certification.certification_date|date:'Y-m-d' }}">
                            <input type="text" id="certification_name" name="certification_name" class="form-control" value="{{ certification.certification_name}}">                                         
                            <button class="btn-danger">X</button>

                        </div>
                    {% endfor %}
                    </ul>
                    <div>
                        <a onclick="theaddmorecertifications()" class="btn btn-outline-primary"> + Add More certifications</a>
                    </div>
                </div>
                <!-- copied from summary end -->
            </div>
            <button class="back-btn btn btn-primary">Back</button>
            <button class="next-btn btn btn-danger">Next</button>
        </div>
        <div id="interests" class="question">
            <h1> Interests </h1>
            <div class="row">
                <label for="summary-label" class="control-label">What interests do you know?</label>
            </div>
            <div class="row">
                <ul id="list-interests-container"></ul>
                
                {% for obj in interests %}
                    {{ obj.interest_name }}
                    <a href="{% url 'addeditInterest' tracking obj.interesttracking  %}"> <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit</a>
                    <a href="{% url 'deleteinterest' tracking obj.interesttracking  %}"style='color:red'><i class='fa fa-trash-o' ></i>  Delete</a>
                    
                    <hr>
                {% endfor %}

            </div>
            <div class="row">
                <!-- <a onclick="theaddmoreinterests()" class="btn btn-outline-primary"> + Add more Interests</a> -->
                <a href="{% url 'addeditInterest' tracking newone  %}" class="btn btn-outline-primary"> + Add new one</a>

            </div>
            <button class="back-btn btn btn-primary">Back</button>
            <button class="next-btn btn btn-danger">Next</button>
        </div>
        <div id="yourown" class="question">
            <h1> Add for: <div id="yourownname"></div>
            </h1>
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <!-- <textarea id="additional-info-description" name="additional-info-description" rows="6" cols="120" style="max-width:100%;" placeholder="Write your addtional information here"></textarea> -->
                        <form method="post" >
                            {% csrf_token %}
                                    <div class="row">
                                        <div class="form-group">
                                            {{ own_form.yourown_name }}
                                        </div>
                                    </div>
                            <button type="submit" name="own_form_submit" class="btn btn-danger">Save And Next</button>
                        </form>
                    </div>
                </div>
            </div>
            <!-- start button -->
            <button class="back-btn btn btn-primary">Back</button>

            <!-- end button  -->
        </div>
    </div>


</div>

		<!-- script for accomplishments start -->
		<script id="for-accomplishments-job-titles">
			$(document).ready(function() {
						$('#search-box-accomplishments').keyup(function() {
								var query = $('#search-box-accomplishments').val();
								if (query.length > 0) {
									$.ajax({
											url: 'http://localhost/summary-job-titles.php',
											type: 'POST',
											dataType: 'json',
											data: {
												search_query: query
											},
											success: function(data) {
												$('#search-suggestions-accomplishments').empty();
												if (data.length > 0) {
													$.each(data, function(index, value) {
															$('#search-suggestions-accomplishments').append(' < li > '+value.title+' < /li>');
															}); $('#search-suggestions-accomplishments').show();
													}
												}
											});
									}
									else {
										$('#search-suggestions-accomplishments').hide();
									}
								}); $('#search-suggestions-accomplishments').on('click', 'li', function() {
								var suggestion = $(this).text();
								$('#search-box-accomplishments').val(suggestion);
								$('#search-suggestions-accomplishments').hide();
								// added start 
								var query = suggestion;
								if (query.length > 0) {
									$.ajax({
										url: 'http://localhost/summary-job-titles.php',
										type: 'POST',
										dataType: 'json',
										data: {
											search_query: query
										},
										success: function(data) {
											if (data[0].relatedJobTitles.length > 0) {
												var relatedJobTitles = data[0].relatedJobTitles;
												var relatedJobTitlesList = " < ul > ";
												relatedJobTitles.forEach(function(title) {
													relatedJobTitlesList += " < li style = 'font-size:0.875em' > "  + " < a href = '#' > " + title + " < /a>" + " < /li>";
												});
												relatedJobTitlesList += " < /ul>";
												var html = " < p > < strong > Related job titles: < /strong> < /p>" + relatedJobTitlesList;
												$("#related-popular-accomplishments").html(html);
											} else {
												$('#related-popular-accomplishments').empty();
												if (data.length > 0) {
													var popular = " < ol > ";
													$.each(data, function(index, value) {
														popular += " < li > " + value.title + " < /li>";
													});
													popular += " < /ol>";
													var html = " < p > < strong > Popular job titles: < /strong> < /p>" +  " < a href = '#' > " + popular + " < /a>" ;
													$("#related-popular-accomplishments").html(html);
												}
											}
										}
									});
									//adding event ha
									// add a click event handler to the links-container element
									$('#related-popular-accomplishments').on('click', 'a', function(event) {
										// prevent the default behavior of following the link
										event.preventDefault();
										// handle the click event here
										var searchValue = $(this).text();
										$("#search-box-accomplishments").val(searchValue);
										searchsummary();
									});
									//adding event ha
								} else {
									$('#search-suggestions-accomplishments').hide();
								}
								// added end 
							});
						});
		</script>
		<script id="for-accomplishments-search-accomplishments">
			const searchBoxaccomplishments = document.getElementById("search-box-accomplishments");
			const searchBtnaccomplishments = document.getElementById("btn-title-search-accomplishments");
			searchBoxaccomplishments.addEventListener("keypress", function(event) {
				if (event.key === "Enter") {
					searchsummaryaccomplishments();
				}
			});
			searchBtnaccomplishments.addEventListener("click", searchsummaryaccomplishments);

			function searchsummaryaccomplishments() {
				const searchBtnaccomplishments = document.getElementById('btn-title-search-accomplishments');
				const searchInputaccomplishments = document.getElementById('search-box-accomplishments');
				const resultsDivaccomplishments = document.getElementById("suggestions");
				const resultListaccomplishments = document.getElementById('result-list-accomplishments');
				const loadingaccomplishments = document.getElementById('loading-accomplishments');
				const jobtitledisplayaccomplishments = document.getElementById("jobtitledisplay-accomplishments");
				jobtitledisplayaccomplishments.textContent = searchBoxaccomplishments.value;
				const urlaccomplishments = `http://localhost/job-accomplishments-suggestions.php/?search_query=${searchInputaccomplishments.value}`;
				loadingaccomplishments.style.display = 'block';
				fetch(urlaccomplishments).then(response => response.json()).then(data => {
					resultListaccomplishments.innerHTML = '';
					data.result.forEach(result => {
						const liaccomplishments = document.createElement('li');
						const buttonaccomplishments = document.createElement('button');
						buttonaccomplishments.classList.add("btn");
						buttonaccomplishments.classList.add("btn-primary");
						buttonaccomplishments.innerText = 'Add';
						buttonaccomplishments.setAttribute("id", "addremovesummary-accomplishments");
						let spanaccomplishments = document.createElement('div');
						spanaccomplishments.innerHTML = result.text;
						liaccomplishments.appendChild(buttonaccomplishments);
						liaccomplishments.appendChild(spanaccomplishments);
						resultListaccomplishments.appendChild(liaccomplishments);
						//add remove button
						// Get the button and textarea elements
						//const myButton = document.getElementById("myButton");
						const myTextareaaccomplishments = document.getElementById("id_accomplishments");
						// Add a click event listener to the button
						buttonaccomplishments.addEventListener("click", function() {
							// Copy the text from the input element to the textarea
							const textaccomplishments = this.nextElementSibling.textContent.trim();
							const myInputaccomplishments = textaccomplishments;
							myTextareaaccomplishments.value += textaccomplishments + " ";
							buttonaccomplishments.textContent = "REMOVE";
							// Toggle the button color between danger and primary
							if (buttonaccomplishments.classList.contains("btn-danger")) {
								buttonaccomplishments.classList.remove("btn-danger");
								buttonaccomplishments.classList.add("btn-primary");
								buttonaccomplishments.textContent = "ADD";
								const startaccomplishments = myTextareaaccomplishments.value.indexOf(myInputaccomplishments);
								const endaccomplishments = startaccomplishments + myInputaccomplishments.length;
								// Remove the copied text from the textarea
								myTextareaaccomplishments.value = myTextareaaccomplishments.value.substring(0, startaccomplishments) + myTextareaaccomplishments.value.substring(endaccomplishments);
								myTextareaaccomplishments.value = myTextareaaccomplishments.value.replace(myInputaccomplishments, "");
							} else {
								buttonaccomplishments.classList.remove("btn-primary");
								buttonaccomplishments.classList.add("btn-danger");
							}
						});
						//add remove button
					});
					loadingaccomplishments.style.display = 'none';
				}).catch(error => {
					console.error(error);
					loadingaccomplishments.style.display = 'none';
				});
			}
		</script>
		<!-- script for accomplishments end -->

        <!-- script for affiliations start -->
		<script id="for-affiliations-job-titles">
			$(document).ready(function() {
						$('#search-box-affiliations').keyup(function() {
								var query = $('#search-box-affiliations').val();
								if (query.length > 0) {
									$.ajax({
											url: 'http://localhost/summary-job-titles.php',
											type: 'POST',
											dataType: 'json',
											data: {
												search_query: query
											},
											success: function(data) {
												$('#search-suggestions-affiliations').empty();
												if (data.length > 0) {
													$.each(data, function(index, value) {
															$('#search-suggestions-affiliations').append(' < li > '+value.title+' < /li>');
															}); $('#search-suggestions-affiliations').show();
													}
												}
											});
									}
									else {
										$('#search-suggestions-affiliations').hide();
									}
								}); $('#search-suggestions-affiliations').on('click', 'li', function() {
								var suggestion = $(this).text();
								$('#search-box-affiliations').val(suggestion);
								$('#search-suggestions-affiliations').hide();
								// added start 
								var query = suggestion;
								if (query.length > 0) {
									$.ajax({
										url: 'http://localhost/summary-job-titles.php',
										type: 'POST',
										dataType: 'json',
										data: {
											search_query: query
										},
										success: function(data) {
											if (data[0].relatedJobTitles.length > 0) {
												var relatedJobTitles = data[0].relatedJobTitles;
												var relatedJobTitlesList = " < ul > ";
												relatedJobTitles.forEach(function(title) {
													relatedJobTitlesList += " < li style = 'font-size:0.875em' > "  + " < a href = '#' > " + title + " < /a>" + " < /li>";
												});
												relatedJobTitlesList += " < /ul>";
												var html = " < p > < strong > Related job titles: < /strong> < /p>" + relatedJobTitlesList;
												$("#related-popular-affiliations").html(html);
											} else {
												$('#related-popular-affiliations').empty();
												if (data.length > 0) {
													var popular = " < ol > ";
													$.each(data, function(index, value) {
														popular += " < li > " + value.title + " < /li>";
													});
													popular += " < /ol>";
													var html = " < p > < strong > Popular job titles: < /strong> < /p>" +  " < a href = '#' > " + popular + " < /a>" ;
													$("#related-popular-affiliations").html(html);
												}
											}
										}
									});
									//adding event ha
									// add a click event handler to the links-container element
									$('#related-popular-affiliations').on('click', 'a', function(event) {
										// prevent the default behavior of following the link
										event.preventDefault();
										// handle the click event here
										var searchValue = $(this).text();
										$("#search-box-affiliations").val(searchValue);
										searchsummary();
									});
									//adding event ha
								} else {
									$('#search-suggestions-affiliations').hide();
								}
								// added end 
							});
						});
		</script>
		<script id="for-affiliations-search-affiliations">
			const searchBoxaffiliations = document.getElementById("search-box-affiliations");
			const searchBtnaffiliations = document.getElementById("btn-title-search-affiliations");
			searchBoxaffiliations.addEventListener("keypress", function(event) {
				if (event.key === "Enter") {
					searchsummaryaffiliations();
				}
			});
			searchBtnaffiliations.addEventListener("click", searchsummaryaffiliations);

			function searchsummaryaffiliations() {
				const searchBtnaffiliations = document.getElementById('btn-title-search-affiliations');
				const searchInputaffiliations = document.getElementById('search-box-affiliations');
				const resultsDivaffiliations = document.getElementById("suggestions");
				const resultListaffiliations = document.getElementById('result-list-affiliations');
				const loadingaffiliations = document.getElementById('loading-affiliations');
				const jobtitledisplayaffiliations = document.getElementById("jobtitledisplay-affiliations");
				jobtitledisplayaffiliations.textContent = searchBoxaffiliations.value;
				const urlaffiliations = `http://localhost/job-affiliations-suggestions.php/?search_query=${searchInputaffiliations.value}`;
				loadingaffiliations.style.display = 'block';
				fetch(urlaffiliations).then(response => response.json()).then(data => {
					resultListaffiliations.innerHTML = '';
					data.result.forEach(result => {
						const liaffiliations = document.createElement('li');
						const buttonaffiliations = document.createElement('button');
						buttonaffiliations.classList.add("btn");
						buttonaffiliations.classList.add("btn-primary");
						buttonaffiliations.innerText = 'Add';
						buttonaffiliations.setAttribute("id", "addremovesummary-affiliations");
						let spanaffiliations = document.createElement('div');
						spanaffiliations.innerHTML = result.text;
						liaffiliations.appendChild(buttonaffiliations);
						liaffiliations.appendChild(spanaffiliations);
						resultListaffiliations.appendChild(liaffiliations);
						//add remove button
						// Get the button and textarea elements
						//const myButton = document.getElementById("myButton");
						const myTextareaaffiliations = document.getElementById("id_affiliations");
						// Add a click event listener to the button
						buttonaffiliations.addEventListener("click", function() {
							// Copy the text from the input element to the textarea
							const textaffiliations = this.nextElementSibling.textContent.trim();
							const myInputaffiliations = textaffiliations;
							myTextareaaffiliations.value += textaffiliations + " ";
							buttonaffiliations.textContent = "REMOVE";
							// Toggle the button color between danger and primary
							if (buttonaffiliations.classList.contains("btn-danger")) {
								buttonaffiliations.classList.remove("btn-danger");
								buttonaffiliations.classList.add("btn-primary");
								buttonaffiliations.textContent = "ADD";
								const startaffiliations = myTextareaaffiliations.value.indexOf(myInputaffiliations);
								const endaffiliations = startaffiliations + myInputaffiliations.length;
								// Remove the copied text from the textarea
								myTextareaaffiliations.value = myTextareaaffiliations.value.substring(0, startaffiliations) + myTextareaaffiliations.value.substring(endaffiliations);
								myTextareaaffiliations.value = myTextareaaffiliations.value.replace(myInputaffiliations, "");
							} else {
								buttonaffiliations.classList.remove("btn-primary");
								buttonaffiliations.classList.add("btn-danger");
							}
						});
						//add remove button
					});
					loadingaffiliations.style.display = 'none';
				}).catch(error => {
					console.error(error);
					loadingaffiliations.style.display = 'none';
				});
			}
		</script>
		<!-- script for affiliations end -->

        <script>
            function ratingfunction() {
				// https://jsuites.net/v4/rating
				const ratingElements = document.querySelectorAll('.rating');
				// Loop through each red element
				for (let i = 0; i < ratingElements.length; i++) {
					const ratingElement = ratingElements[i];
                    const ratingvalue = ratingElement.textContent
                    
					// Check if the red element also has class "bold"				
                    var myRating = jSuites.rating(ratingElement, {
                        value: parseInt(ratingvalue),
                        tooltip: ['Very bad', 'Bad', 'Average', 'Good', 'Very good'],
                    });
					
				}
			}
        </script>

        <script>
            window.addEventListener('DOMContentLoaded', () => {
        
            ratingfunction()
            });
    

        </script>

  <!-- software start  -->
    <script>
        // Get the CSRF token from the HTML meta tag
        var csrfToken = document.querySelector('[name=csrf-token]').content;

        // Get the table body element
        var tableBody = document.querySelector('#software-table tbody');

        // Function to render a row in the table
        function renderRow(software) {
            // Create a new row element
            var row = document.createElement('tr');
            var td1 = document.createElement('td');
            var td2 = document.createElement('td');

            // Create two new input elements for the software name and proficiency
            var nameInput = document.createElement('input');

            

            nameInput.type = 'text';
            nameInput.value = software.software_name;
            var proficiencyInput = software.proficiency;


            var thediv = document.createElement('jsuites-rating');
            thediv.setAttribute('value',software.proficiency);
            thediv.setAttribute('tooltip','Ugly, Bad, Average, Good, Outstanding');

            thediv.addEventListener('onchange', function(e) {
                updateSoftware(software, nameInput.value, this.value);

            });

        
            const id = software.id; // Replace with the actual ID of the software to be deleted
            const deletelink = document.createElement('a');
            deletelink.href = `http://127.0.0.1:8000/api/delete-software/${id}`;
            deletelink.innerHTML = 'Delete software';
            deletelink.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the link from navigating to the URL

            const xhr = new XMLHttpRequest();
            xhr.open('DELETE', deletelink.href);
            xhr.setRequestHeader('X-CSRFToken', csrfToken);
            xhr.onload = function() {
                if (xhr.status === 200) {
                console.log('Software deleted successfully!');
                location.reload();
                } else {
                console.error('An error occurred while deleting the software:', xhr.statusText);
                }
            };
            xhr.onerror = function() {
                console.error('An error occurred while deleting the software:', xhr.statusText);
            };
            xhr.send();
            });


        

            // Append the input elements to the row
            td1.appendChild(nameInput);
            td2.appendChild(thediv);
            td1.appendChild(deletelink);

            
            row.appendChild(td1);
            row.appendChild(td2);


            // Add an event listener to the input elements to update the software data on change
            nameInput.addEventListener('change', function() {
                updateSoftware(software, nameInput.value, proficiencyInput);
            });

                // Add the row to the table body
                tableBody.appendChild(row);
            }

        // Function to update a software with new data
        function updateSoftware(software, name, proficiency) {
            // Create a new PUT request with the updated data
            var xhr = new XMLHttpRequest();
            xhr.open('PUT', '/api/add-edit-software/');
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('X-CSRFToken', csrfToken);
            xhr.onload = function() {
                if (xhr.status === 200) {
                console.log('Software updated:');
                } else {
                    console.error('Error updating software:');
                }
            };
            xhr.send(JSON.stringify({
                'softwaretracking': software.softwaretracking,
                'resume': software.resume,
                'software_name': name,
                'proficiency': proficiency
            }));
        }

        // Fetch the list of software from the API and render the table rows
        fetch('/api/softwares/')
            .then(response => response.json())
            .then(data => data.forEach(renderRow));
    </script>
  <!-- software end -->

    <!-- language start  -->
    <script>
        // Get the CSRF token from the HTML meta tag
        var csrfTokenl = document.querySelector('[name=csrf-token]').content;

        // Get the table body element
        var tableBodyl = document.querySelector('#language-table tbody');

        // Function to render a row in the table
        function renderRowl(language) {
            // Create a new row element
            var rowl = document.createElement('tr');
            var td1l = document.createElement('td');
            var td2l = document.createElement('td');

            // Create two new input elements for the language name and proficiency
            var nameInputl = document.createElement('input');

            

            nameInputl.type = 'text';
            nameInputl.value = language.language_name;
            var proficiencyInputl = language.proficiency;


            var thedivl = document.createElement('jsuites-rating');
            thedivl.setAttribute('value',language.proficiency);
            thedivl.setAttribute('tooltip','Ugly, Bad, Average, Good, Outstanding');

            thedivl.addEventListener('onchange', function(e) {
                updateLanguage(language, nameInputl.value, this.value);

            });

        
            const idl = language.id; // Replace with the actual ID of the language to be deleted
            const deletelinkl = document.createElement('a');
            deletelinkl.href = `http://127.0.0.1:8000/api/delete-language/${idl}`;
            deletelinkl.innerHTML = 'Delete language';
            deletelinkl.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the link from navigating to the URL

            const xhrl = new XMLHttpRequest();
            xhrl.open('DELETE', deletelinkl.href);
            xhrl.setRequestHeader('X-CSRFToken', csrfToken);
            xhrl.onload = function() {
                if (xhrl.status === 200) {
                console.log('Language deleted successfully!');
                location.reload();
                } else {
                console.error('An error occurred while deleting the language:', xhrl.statusText);
                }
            };
            xhrl.onerror = function() {
                console.error('An error occurred while deleting the language:', xhrl.statusText);
            };
            xhrl.send();
            });


        

            // Append the input elements to the row
            td1l.appendChild(nameInputl);
            td2l.appendChild(thedivl);
            td1l.appendChild(deletelinkl);

            
            rowl.appendChild(td1l);
            rowl.appendChild(td2l);


            // Add an event listener to the input elements to update the language data on change
            nameInputl.addEventListener('change', function() {
                updateLanguage(language, nameInputl.value, proficiencyInputl);
            });

                // Add the row to the table body
                tableBodyl.appendChild(rowl);
            }

        // Function to update a language with new data
        function updateLanguage(language, name, proficiency) {
            // Create a new PUT request with the updated data
            var xhrl = new XMLHttpRequest();
            xhrl.open('PUT', '/api/add-edit-language/');
            xhrl.setRequestHeader('Content-Type', 'application/json');
            xhrl.setRequestHeader('X-CSRFToken', csrfToken);
            xhrl.onload = function() {
                if (xhrl.status === 200) {
                console.log('Language updated:');
                } else {
                    console.error('Error updating language:');
                }
            };
            xhrl.send(JSON.stringify({
                'languagetracking': language.languagetracking,
                'resume': language.resume,
                'language_name': name,
                'proficiency': proficiency
            }));
        }

        // Fetch the list of language from the API and render the table rows
        fetch('/api/languages/')
            .then(response => response.json())
            .then(data => data.forEach(renderRowl));
    </script>
  <!-- language end -->

  <!-- script for certifications start -->
    <script id="for-certifications-job-titles">
        $(document).ready(function() {
                $('#search-box-certifications').keyup(function() {
                        var query = $('#search-box-certifications').val();
                        if (query.length > 0) {
                            $.ajax({
                                    url: 'http://localhost/summary-job-titles.php',
                                    type: 'POST',
                                    dataType: 'json',
                                    data: {
                                        search_query: query
                                    },
                                    success: function(data) {
                                        $('#search-suggestions-certifications').empty();
                                        if (data.length > 0) {
                                            $.each(data, function(index, value) {
                                                    $('#search-suggestions-certifications').append(' < li > '+value.title+' < /li>');
                                                    }); $('#search-suggestions-certifications').show();
                                            }
                                        }
                                    });
                            }
                            else {
                                $('#search-suggestions-certifications').hide();
                            }
                        }); $('#search-suggestions-certifications').on('click', 'li', function() {
                        var suggestion = $(this).text();
                        $('#search-box-certifications').val(suggestion);
                        $('#search-suggestions-certifications').hide();
                        // added start 
                        var query = suggestion;
                        if (query.length > 0) {
                            $.ajax({
                                url: 'http://localhost/summary-job-titles.php',
                                type: 'POST',
                                dataType: 'json',
                                data: {
                                    search_query: query
                                },
                                success: function(data) {
                                    if (data[0].relatedJobTitles.length > 0) {
                                        var relatedJobTitles = data[0].relatedJobTitles;
                                        var relatedJobTitlesList = " < ul > ";
                                        relatedJobTitles.forEach(function(title) {
                                            relatedJobTitlesList += " < li style = 'font-size:0.875em' > "  + " < a href = '#' > " + title + " < /a>" + " < /li>";
                                        });
                                        relatedJobTitlesList += " < /ul>";
                                        var html = " < p > < strong > Related job titles: < /strong> < /p>" + relatedJobTitlesList;
                                        $("#related-popular-certifications").html(html);
                                    } else {
                                        $('#related-popular-certifications').empty();
                                        if (data.length > 0) {
                                            var popular = " < ol > ";
                                            $.each(data, function(index, value) {
                                                popular += " < li > " + value.title + " < /li>";
                                            });
                                            popular += " < /ol>";
                                            var html = " < p > < strong > Popular job titles: < /strong> < /p>" +  " < a href = '#' > " + popular + " < /a>" ;
                                            $("#related-popular-certifications").html(html);
                                        }
                                    }
                                }
                            });
                            //adding event ha
                            // add a click event handler to the links-container element
                            $('#related-popular-certifications').on('click', 'a', function(event) {
                                // prevent the default behavior of following the link
                                event.preventDefault();
                                // handle the click event here
                                var searchValue = $(this).text();
                                $("#search-box-certifications").val(searchValue);
                                searchsummary();
                            });
                            //adding event ha
                        } else {
                            $('#search-suggestions-certifications').hide();
                        }
                        // added end 
                    });
                });
    </script>
    <script id="for-certifications-search-certifications">
        const searchBoxcertifications = document.getElementById("search-box-certifications");
        const searchBtncertifications = document.getElementById("btn-title-search-certifications");
        searchBoxcertifications.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                searchsummarycertifications();
            }
        });
        searchBtncertifications.addEventListener("click", searchsummarycertifications);

        function searchsummarycertifications() {
            const searchBtncertifications = document.getElementById('btn-title-search-certifications');
            const searchInputcertifications = document.getElementById('search-box-certifications');
            const resultsDivcertifications = document.getElementById("suggestions");
            const resultListcertifications = document.getElementById('result-list-certifications');
            const loadingcertifications = document.getElementById('loading-certifications');
            const jobtitledisplaycertifications = document.getElementById("jobtitledisplay-certifications");
            jobtitledisplaycertifications.textContent = searchBoxcertifications.value;
            const urlcertifications = `http://localhost/job-certifications-suggestions.php/?search_query=${searchInputcertifications.value}`;
            loadingcertifications.style.display = 'block';
            fetch(urlcertifications).then(response => response.json()).then(data => {
                resultListcertifications.innerHTML = '';
                data.result.forEach(result => {
                    const licertifications = document.createElement('li');
                    const buttoncertifications = document.createElement('button');
                    buttoncertifications.classList.add("btn");
                    buttoncertifications.classList.add("btn-primary");
                    buttoncertifications.innerText = 'Add';
                    buttoncertifications.setAttribute("id", "addremovesummary-certifications");
                    let spancertifications = document.createElement('div');
                    spancertifications.innerHTML = result.text;
                    licertifications.appendChild(buttoncertifications);
                    licertifications.appendChild(spancertifications);
                    resultListcertifications.appendChild(licertifications);
                    //add remove button
                    // Get the button and textarea elements
                    //const myButton = document.getElementById("myButton");
                    // Add a click event listener to the button
                    buttoncertifications.addEventListener("click", function() {
                        // Copy the text from the input element to the textarea
                        const textcertifications = this.nextElementSibling.textContent.trim();
                        const myInputcertifications = textcertifications;
                        buttoncertifications.textContent = "REMOVE";
                        //added certifications start
                        const listContainer = document.getElementById('list-certifications-container');
                        const listItem = document.createElement('div');
                        listItem.classList.add('containerxx');
                        listItem.setAttribute("id", Math.random().toString(36).substr(2, 9));


                        const textxxx = this.nextElementSibling.textContent.trim();
                        const listItems = listContainer.querySelectorAll('div');
                        const numberOfItems = listItems.length;
                        var dateInput = document.createElement("input");
                        dateInput.setAttribute("type", "date");
                        dateInput.setAttribute('id', 'certification-date-element-' + numberOfItems);
                        dateInput.setAttribute('name', 'certification-date-element-' + numberOfItems);

                        const textBox = document.createElement('input');
                        textBox.type = 'text';
                        textBox.setAttribute('id', 'certification-textbox-' + numberOfItems);
                        textBox.setAttribute('name', 'certification-textbox-' + numberOfItems);

                        textBox.classList.add("certification-textbox");
                        textBox.value = textxxx;
                        // Create a delete button
                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'X';
                        deleteButton.classList.add("btn-danger");
                        // Add the rating element, textbox, and delete button to the list item
                        listItem.appendChild(dateInput);
                        listItem.appendChild(textBox);
                        listItem.appendChild(deleteButton);
                        // Add the list item to the container
                        listContainer.appendChild(listItem);
                        deletecertifications();
                        // Get all the delete buttons
                        var deleteButtons = document.querySelectorAll("#list-container button");
                        // Loop through the delete buttons and attach a click event listener
                        deleteButtons.forEach(function(button) {
                            button.addEventListener("click", function() {
                                // Get the parent list item of the clicked button and remove it
                                var listItem = button.parentNode;
                                console.log(listItem);
                                listItem.remove();
                            });
                        });
                        // Toggle the button color between danger and primary
                        if (buttoncertifications.classList.contains("btn-danger")) {
                            buttoncertifications.classList.remove("btn-danger");
                            buttoncertifications.classList.add("btn-primary");
                            buttoncertifications.textContent = "ADD";
                            // Get the word to match
                            var wordToMatch = myInputcertifications;
                            // Find the textbox that has a value matching the word
                            //var textbox = document.querySelector('.certification-textbox');
                            // const searchStr = wordToMatch;
                            var textbox = document.querySelector(`input[type="text"].certification-textbox[value*="${wordToMatch}"]`);
                            console.log("start ");
                            var textboxes = document.querySelectorAll(`input[type="text"].certification-textbox`);
                            for (var i = 0; i < textboxes.length; i++) {
                                if (textboxes[i].value.includes(wordToMatch)) {
                                    var textbox = textboxes[i];
                                    var listItemx = textbox.parentNode;
                                    listItem.remove(listItemx)
                                    listItemx.remove();
                                    console.log("from :" + listItemx);
                                    console.log("textbox removed");
                                    // Your code here
                                }
                            }
                            console.log("end ");
                        } else {
                            buttoncertifications.classList.remove("btn-primary");
                            buttoncertifications.classList.add("btn-danger");
                        }
                        //added certifications end
                    });
                    //add remove button
                });
                loadingcertifications.style.display = 'none';
            }).catch(error => {
                console.error(error);
                loadingcertifications.style.display = 'none';
            });
        }

        function theaddmorecertifications() {
            const listContainer = document.getElementById('list-certifications-container');
            const listItem = document.createElement('div');
            listItem.classList.add("containerxx");
            
            listItem.setAttribute("id", Math.random().toString(36).substr(2, 9));

           

            
            const textxxx = "";
            const listItems = listContainer.querySelectorAll('div');
            const numberOfItems = listItems.length;
            var dateInput = document.createElement("input");
            dateInput.setAttribute("type", "date");
            dateInput.setAttribute('id', 'date-element-' + numberOfItems);
            const textBox = document.createElement('input');
            textBox.type = 'text';
            textBox.setAttribute('id', 'certification-textbox-' + numberOfItems);
            textBox.setAttribute('name', 'certification-textbox-' + numberOfItems);
            textBox.classList.add("certification-textbox");
            textBox.value = textxxx;
            // Create a delete button
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'X';
            deleteButton.classList.add("btn-danger");
            // Add the rating element, textbox, and delete button to the list item
            listItem.appendChild(dateInput);
            listItem.appendChild(textBox);
            listItem.appendChild(deleteButton);
            // Add the list item to the container
            listContainer.appendChild(listItem);
            // Get all the delete buttons
            deletecertifications();
        }

        function deletecertifications() {
            var deleteButtons = document.querySelectorAll("#list-certifications-container button");
            // Loop through the delete buttons and attach a click event listener
            deleteButtons.forEach(function(button) {
                button.addEventListener("click", function() {
                    // Get the parent list item of the clicked button and remove it
                    var listItem = button.parentNode;
                    listItem.remove();
                });
            });
        }
    </script>

    <script>
        function addEditCertification(certificationtracking) {
        // Get the certification date and name input values
        var dateValue = document.getElementById(certificationtracking).querySelector('input[type="date"]').value;
        var nameValue = document.getElementById(certificationtracking).querySelector('input[type="text"]').value;

        // Create a data object with the input values and the resume value
         // Get the pathname of the current URL
         var pathname = window.location.pathname;
        // Extract the string after the last slash
        var resumetracking = pathname.substring(pathname.lastIndexOf('/') + 1);
        // Log the extracted string to the console
        console.log("resumetracking : " + resumetracking);
            
        // Send a POST request to the API endpoint
        var xhrcer = new XMLHttpRequest();
        xhrcer.open("PUT", "http://127.0.0.1:8000/api/add-edit-certification/", true);
        xhrcer.setRequestHeader("Content-Type", "application/json");
        xhrcer.setRequestHeader('X-CSRFToken', csrfToken);

        xhrcer.onreadystatechange = function() {
            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
            console.log("Certification data sent successfully!");
            }
        };

        var data = JSON.stringify({
            certification_name: nameValue,
            certification_date: dateValue,
            certificationtracking: certificationtracking,
            resume: resumetracking
        });

        xhrcer.send(data);

        }

        // Add event listeners to the date and name inputs
        var certifications = document.querySelectorAll('#list-certifications-container .containerxx');
        certifications.forEach(function(certification) {
        var certificationtracking = certification.id;
        var dateInput = certification.querySelector('input[type="date"]');
        var nameInput = certification.querySelector('input[type="text"]');

        dateInput.addEventListener('change', function() {
            addEditCertification(certificationtracking);
        });

        nameInput.addEventListener('input', function() {
            addEditCertification(certificationtracking);
        });
        });

    </script>
<!-- script for certifications end -->
    
{% endblock content %}




